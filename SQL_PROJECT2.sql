CREATE DATABASE RETAILSALES_DB
 USE RETAILSALES_DB

 CREATE TABLE Customers (
    customer_id INT PRIMARY KEY,
    customer_name VARCHAR(50),
    city VARCHAR(50),
    signup_date DATE
);

CREATE TABLE Products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(50),
    category VARCHAR(50),
    price DECIMAL(10,2)
);

CREATE TABLE Orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    product_id INT,
    quantity INT,
    order_date DATE,
    FOREIGN KEY (customer_id) REFERENCES Customers(customer_id),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

INSERT INTO Customers VALUES
(1,'Amit','Delhi','2023-01-10'),
(2,'Sneha','Mumbai','2023-02-12'),
(3,'Rahul','Bangalore','2023-03-15'),
(4,'Priya','Hyderabad','2023-04-18'),
(5,'Arjun','Chennai','2023-05-20'),
(6,'Neha','Pune','2023-06-25'),
(7,'Vikas','Delhi','2023-07-01'),
(8,'Anjali','Kolkata','2023-07-12');

INSERT INTO Products VALUES
(101,'Laptop','Electronics',60000),
(102,'Mobile','Electronics',30000),
(103,'Headphones','Accessories',2000),
(104,'Keyboard','Accessories',1500),
(105,'Chair','Furniture',7000),
(106,'Desk','Furniture',12000);

INSERT INTO Orders VALUES
(1001,1,101,1,'2023-08-01'),
(1002,1,103,2,'2023-08-05'),
(1003,2,102,1,'2023-08-10'),
(1004,3,105,1,'2023-08-15'),
(1005,4,106,1,'2023-08-18'),
(1006,5,101,1,'2023-08-20'),
(1007,6,104,3,'2023-08-25'),
(1008,7,103,1,'2023-08-26'),
(1009,8,102,2,'2023-08-27'),
(1010,2,105,2,'2023-08-28'),
(1011,3,101,1,'2023-08-29'),
(1012,4,103,4,'2023-08-30');

SELECT *FROM Customers
SELECT *FROM Products
SELECT *FROM Orders


--Q1.Finding total number of customers per city?

SELECT city, COUNT(*) AS total_customers
FROM Customers
GROUP BY city;

--Q2.Find total revenue generated by each product?

SELECT p.product_name,
       SUM(o.quantity * p.price) AS total_revenue
FROM Orders o
JOIN Products p ON o.product_id = p.product_id
GROUP BY p.product_name;

--Q3.Find top 3 best-selling products by revenue?

SELECT  TOP 3 p.product_name,
       SUM(o.quantity * p.price) AS revenue
FROM Orders o
JOIN Products p ON o.product_id = p.product_id
GROUP BY p.product_name
ORDER BY revenue DESC

--Q4.Find customers who spent more than ?50,000?

SELECT c.customer_name,
       SUM(o.quantity * p.price) AS total_spent
FROM Orders o
JOIN Customers c ON o.customer_id = c.customer_id
JOIN Products p ON o.product_id = p.product_id
GROUP BY c.customer_name
HAVING SUM(o.quantity * p.price) > 50000;

--Q5.Find monthly total sales?

SELECT MONTH(order_date) AS month,
       SUM(o.quantity * p.price) AS monthly_sales
FROM Orders o
JOIN Products p ON o.product_id = p.product_id
GROUP BY MONTH(order_date);

--Q6.Find customers who never placed an order?

SELECT C.customer_name
FROM Customers C
LEFT JOIN ORDERS O
ON C.customer_id=O.customer_id
WHERE O.customer_id IS NULL;

--Q7.Categorize customers based on spending?

SELECT c.customer_name,
       SUM(o.quantity * p.price) AS total_spent,
       CASE
           WHEN SUM(o.quantity * p.price) > 80000 THEN 'Premium'
           WHEN SUM(o.quantity * p.price) BETWEEN 40000 AND 80000 THEN 'Gold'
           ELSE 'Regular'
       END AS customer_category
FROM Orders o
JOIN Customers c ON o.customer_id = c.customer_id
JOIN Products p ON o.product_id = p.product_id
GROUP BY c.customer_name;

--Q8.Find the most popular product category?

SELECT TOP 1 p.category,
       SUM(o.quantity) AS total_quantity
FROM Orders o
JOIN Products p ON o.product_id = p.product_id
GROUP BY p.category
ORDER BY total_quantity DESC

--Q9.Find average order value?

SELECT AVG(order_total) AS avg_order_value
FROM (
    SELECT order_id,
           SUM(o.quantity * p.price) AS order_total
    FROM Orders o
    JOIN Products p ON o.product_id = p.product_id
    GROUP BY order_id
) t;

--Q10.Find repeat customers (more than 1 order)?

SELECT c.customer_name,
       COUNT(o.order_id) AS total_orders
FROM Orders o
JOIN Customers c ON o.customer_id = c.customer_id
GROUP BY c.customer_name
HAVING COUNT(o.order_id) > 1;
